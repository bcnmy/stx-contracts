{"language":"Solidity","sources":{"contracts/composability/ComposableStorage.sol":{"content":"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.17;\n\n/**\n * @title ComposableStorage\n * @dev Contract to handle generic storage operations with cross-chain support\n */\ncontract ComposableStorage {\n    error SlotNotInitialized();\n\n    // Mapping to track initialized slots\n    mapping(bytes32 => bool) private initializedSlots;\n\n    // Mapping to track length of dynamic data\n    mapping(bytes32 => uint256) private dynamicDataLength;\n\n    /**\n     * @dev Internal function to write a value to a specific storage slot\n     */\n    function _writeStorage(bytes32 slot, bytes32 value, bytes32 namespace) private {\n        bytes32 namespacedSlot = getNamespacedSlot(namespace, slot);\n        initializedSlots[namespacedSlot] = true;\n        assembly {\n            sstore(namespacedSlot, value)\n        }\n    }\n\n    /**\n     * @dev Write a value to a specific storage slot\n     * @param slot The storage slot to write to\n     * @param value The value to write\n     */\n    function writeStorage(bytes32 slot, bytes32 value, address account) external {\n        bytes32 namespace = getNamespace(account, msg.sender);\n        _writeStorage(slot, value, namespace);\n    }\n\n    /**\n     * @dev Read a value from a specific namespace and slot\n     * @param namespace The namespace (typically a contract address)\n     * @param slot The storage slot to read from\n     * @return The value stored at the specified namespaced slot\n     */\n    function readStorage(bytes32 namespace, bytes32 slot) external view returns (bytes32) {\n        bytes32 namespacedSlot = getNamespacedSlot(namespace, slot);\n        if (!initializedSlots[namespacedSlot]) {\n            revert SlotNotInitialized();\n        }\n        bytes32 value;\n        assembly {\n            value := sload(namespacedSlot)\n        }\n        return value;\n    }\n\n    /**\n     * @dev Generates a namespaced slot\n     * @param namespace The namespace (typically a contract address)\n     * @param slot The storage slot to read from\n     * @return The namespaced slot\n     */\n    function getNamespacedSlot(bytes32 namespace, bytes32 slot) public pure returns (bytes32) {\n        return keccak256(abi.encodePacked(namespace, slot));\n    }\n\n    /**\n     * @dev Generates a namespace for a given account and caller\n     * @param account The account address\n     * @param caller The caller address\n     * @return The generated namespace\n     */\n    function getNamespace(address account, address caller) public pure returns (bytes32) {\n        return keccak256(abi.encodePacked(account, caller));\n    }\n\n    /**\n     * @dev Check if a slot has been initialized\n     */\n    function isSlotInitialized(bytes32 namespace, bytes32 slot) external view returns (bool) {\n        bytes32 namespacedSlot = getNamespacedSlot(namespace, slot);\n        return initializedSlots[namespacedSlot];\n    }\n}\n"}},"settings":{"remappings":["forge-std/=node_modules/forge-std/src/","account-abstraction/=node_modules/account-abstraction/contracts/","solady/=node_modules/solady/src/","sentinellist/=node_modules/@rhinestone/sentinellist/src/","module-bases/=node_modules/@rhinestone/module-bases/src/","erc7739Validator/=node_modules/@erc7579/erc7739-validator-base/src/","EnumerableSet4337/=node_modules/@erc7579/enumerablemap4337/src/","erc7579/=node_modules/@erc7579/implementation/src/","byteslib/=node_modules/solidity-bytes-utils/contracts/","rlp-reader/=node_modules/solidity-rlp/contracts/","murky-trees/=node_modules/murky/src/","solarray/=node_modules/solarray/src/","excessively-safe-call/=node_modules/excessively-safe-call/src/","@ERC4337/=node_modules/@ERC4337/","@erc7579/=node_modules/@erc7579/","@gnosis.pm/=node_modules/@gnosis.pm/","@openzeppelin/=node_modules/@openzeppelin/","@prb/=node_modules/@prb/","@rhinestone/=node_modules/@rhinestone/","@safe-global/=node_modules/@safe-global/","@zerodev/=node_modules/@zerodev/","account-abstraction-v0.6/=node_modules/account-abstraction-v0.6/","ds-test/=node_modules/ds-test/","hardhat-deploy/=node_modules/hardhat-deploy/","hardhat/=node_modules/hardhat/","solidity-bytes-utils/=node_modules/solidity-bytes-utils/","solidity-rlp/=node_modules/solidity-rlp/"],"optimizer":{"enabled":true,"runs":999},"metadata":{"useLiteralContent":false,"bytecodeHash":"none","appendCBOR":true},"outputSelection":{"*":{"*":["abi","evm.bytecode.object","evm.bytecode.sourceMap","evm.bytecode.linkReferences","evm.deployedBytecode.object","evm.deployedBytecode.sourceMap","evm.deployedBytecode.linkReferences","evm.deployedBytecode.immutableReferences","evm.methodIdentifiers","metadata"]}},"evmVersion":"cancun","viaIR":true,"libraries":{}}}
